# community牛客社区项目



#### 1 技术点：

前端:thymeleaf 动态引擎框架

后端：SpringBoot,Mybatis ，MySQL



#### 2 功能模块

**首页模块**： 分页显示所有的帖子信息。 重点主要在于tymeleaf模板引擎的使用，如何将模型MODEL中绑定的参数交给视图进行动态渲染

**用户账号注册与激活**：

1. 邮件发送工具类，SpringBoot整合SpringMail，使用QQ邮箱作为发件方，利用tymeleaf邮件模板，发送HTML邮件；
2. 用户注册账号，发送一封激活邮件
3. 用户点击激活邮件，激活注册的账号

**账号登录，退出模块**：

``【验证用户信息及验证码进行登录】``

1. 整合Kapatcha，实现生成动态验证码

2. 验证账号，密码，验证码；验证成功后生成登录凭证，验证失败后跳转回登录页面

3. 账号退出时，将登录凭证修改为失效状态，跳转到用户首页、

**显示首页信息**

```txt
登录之后显示正确显示用户信息
使用LoginInterceptor进行拦截，判断用户是否正常登录
显示在页眉的信息会根据登录与否显示的不同。登录之前需要显示注册、登录界面，登录之后显示用户头像，消息等信息
由于http请求的无状态性，多个连续的请求需要保持一致性，所以以为着每个请求都需要判断用户是否登录与否。
此处用到了拦截器对所有的请求进行的统一的处理。【拦截器的主要使用包括两个步骤，实现HandlerInterceptor类，注册Interceptor】
```

在本该功能模块中实现的具体步骤为：

1. 在请求开始时查询登录用户; 【在进入之前执行preHandle】 
2. 本次请求中持有本次用户信息; 【在请求结束前使用的是同一个线程，可将持有的用户信息存入到ThreadLocal中】
3. 在模板视图中显示用户信息; 【postHandle】
4. 在模板视图渲染后显示用户信息; 【afterCompletion】



 **设置用户信息**

1 切换到用户设置页面

2 上传用户头像并更新数据库中用户头像信息【POST请求】

3 修改用戶密码



**检查用户登录状态**

```text
某些功能页面的访问需要登录之后进行访问，需要判断请求是否是成功登录的。【某些指定的功能界面通过自定义注解定义，标注了该注解的方法必须是在登录下进行】
通过拦截器的功能实现。判断是否标注了注解通过反射的方式来判断。
```

**过滤敏感词**

**用戶增加帖子**

使用ajax发送异步请求，使得浏览器不刷新就能动态地显示增量数据。

**查詢帖子詳情**

每一篇帖子都链接到帖子详情的接口，使用thymeleaf动态地替换，并展现帖子的信息【作者头像，作者名字，帖子标题，帖子内容，帖子发布时间】

**查詢帖子评论信息**

分页查询帖子的评论信息，在查询帖子详情的基础上拓展Thymeleaf处理的数据，主要难点在于thymeleaf处理绑定到Model上的数据

**增加帖子评论**

数据层：增加评论，修改评论帖子的评论数

业务层：实现增加评论和增加评论对象的评论数功能

表现层：处理增加评论的请求，前台处理添加评论的表单，处理数据后重定向到帖子详情页面，刷新带出新添加的评论信息 

由于帖子的增加和帖子数的增加数据库上的操作要求原子性，所以该功能将用上**事务**来解决事务不一致出现的问题

**私信列表**

查询当前用户的会话列表，支持分页显示，每个会话之间显示一条最新的私信

该功能模块强调数据Mapper的编写

```
分页用户的查询消息列表【针对每个会话，只返回一条最新的私信】
查询所有会话数目【用于分页】
查询会话的所有私信列表
根据会话id查询当前会话包含的所有私信数目【用于支持分页】
查询当前用户未读的会话【未读私信数】
```

**统一异常管理**

